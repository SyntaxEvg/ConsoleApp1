<?php
/**
 * Core HTTP Request API
 *
 * @package WordPress
 * @subpackage HTTP
 */

// ========================================
// Ð§ÐÐ ÐÐ«Ð™ Ð¡ÐŸÐ˜Ð¡ÐžÐš Ð”ÐžÐœÐ•ÐÐžÐ’ Ð”Ð›Ð¯ Ð‘Ð›ÐžÐšÐ˜Ð ÐžÐ’ÐšÐ˜
// ========================================
function wp_check_blocked_domain($url) {
    // Ð§Ñ‘Ñ€Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº
    $blocked_domains = array(
        'api.wordpress.org',
        'wordpress.org',
        'downloads.wordpress.org',
        's.w.org',
        'ps.w.org',
        // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐ¹/ÑƒÐ´Ð°Ð»ÑÐ¹ Ð´Ð¾Ð¼ÐµÐ½Ñ‹ Ð·Ð´ÐµÑÑŒ
    );
    
    $host = parse_url($url, PHP_URL_HOST);
    
    foreach ($blocked_domains as $blocked) {
        if ($host === $blocked || strpos($host, $blocked) !== false) {
            error_log(sprintf(
                "ðŸš« BLOCKED HTTP REQUEST:\nURL: %s\nHost: %s",
                $url,
                $host
            ));
            return true;
        }
    }
    
    return false;
}

function wp_remote_request( $url, $args = array() ) {
    // ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð§ÐÐ ÐÐžÐ“Ðž Ð¡ÐŸÐ˜Ð¡ÐšÐ
    if (wp_check_blocked_domain($url)) {
        return new WP_Error(
            'http_request_blocked',
            sprintf('HTTP request blocked by security policy: %s', parse_url($url, PHP_URL_HOST))
        );
    }
    
    // ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð´ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹...
    $http = _wp_http_get_object();
    return $http->request( $url, $args );
}
