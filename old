function wp_trigger_error( $function_name, $message, $error_level = E_USER_NOTICE ) {
	if ( ! WP_DEBUG ) {
		return;
	}
	
	do_action( 'wp_trigger_error_run', $function_name, $message, $error_level );
	
	// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤ –î–õ–Ø –í–°–ï–• –û–®–ò–ë–û–ö
	$stack_html = '';
	if ( ! empty( $function_name ) ) {
		$backtrace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 15);
		
		// –í—ã–±–∏—Ä–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏
		$bg_color = '#9C27B0'; // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
		$border_color = '#7B1FA2';
		$icon = 'üîç';
		
		if ( $function_name === '_load_textdomain_just_in_time' ) {
			$bg_color = '#f44336';
			$border_color = '#d32f2f';
			$icon = '‚ùå';
		} elseif ( strpos($function_name, 'deprecated') !== false ) {
			$bg_color = '#2196F3';
			$border_color = '#1976D2';
			$icon = '‚ÑπÔ∏è';
		} elseif ( strpos($function_name, 'doing_it_wrong') !== false || strpos($message, 'incorrectly') !== false ) {
			$bg_color = '#ff9800';
			$border_color = '#f57c00';
			$icon = '‚ö†Ô∏è';
		}
		
		$stack_html = sprintf(
			'<div style="background: %s; color: #fff; padding: 15px; margin: 10px; font-family: monospace; white-space: pre-wrap; border-left: 5px solid %s;">',
			$bg_color,
			$border_color
		);
		$stack_html .= sprintf('<strong>%s FUNCTION: %s</strong>', $icon, esc_html($function_name)) . "\n\n";
		$stack_html .= '<strong>CALL STACK:</strong>' . "\n";
		
		foreach ($backtrace as $i => $trace) {
			if ($i === 0) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
			$file = isset($trace['file']) ? str_replace('/var/www/', '', $trace['file']) : 'unknown';
			$line = isset($trace['line']) ? $trace['line'] : '?';
			$func = isset($trace['function']) ? $trace['function'] : 'unknown';
			$class = isset($trace['class']) ? $trace['class'] . '::' : '';
			$stack_html .= sprintf("#%d %s%s()\n    in %s:%s\n\n", $i - 1, $class, $func, $file, $line);
		}
		$stack_html .= '</div>';
	}
	
	if ( ! empty( $function_name ) ) {
		$message = sprintf( '%s(): %s', $function_name, $message );
	}
	
	// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–µ–∫ –ü–û–°–õ–ï —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ –î–û wp_kses
	if ( ! empty( $stack_html ) ) {
		$message .= $stack_html;
	}
	
	$message = wp_kses(
		$message,
		array(
			'a'      => array( 'href' => true ),
			'br'     => array(),
			'code'   => array(),
			'em'     => array(),
			'strong' => array(),
			'div'    => array( 'style' => true ), // –í–ê–ñ–ù–û: —Ä–∞–∑—Ä–µ—à–∞–µ–º div —Å–æ —Å—Ç–∏–ª—è–º–∏
		),
		array( 'http', 'https' )
	);
	
	if ( E_USER_ERROR === $error_level ) {
		throw new WP_Exception( $message );
	}
	
	trigger_error( $message, $error_level );
}
