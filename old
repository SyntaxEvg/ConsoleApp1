 ***** Starting HAS Identity Provider - Logs initialized with mode Verbose.
 Starting module 2025-HAS Identity Provider - Mode : "Production"
 Using 'https://vmshqeat04.npr.nornick.ru/uas' as openid authority
 ##################################################
 !!! НОВАЯ ВЕРСИЯ КОДА v6 - С ПРОВЕРКОЙ ТАБЛИЦ !!!
 ##################################################
 === EnsureSeedData: НАЧАЛО ===
 Шаг 1: BuildServiceProvider...
 Шаг 1: BuildServiceProvider - OK
 Шаг 2: Получение ApplicationDbContext...
 Шаг 2: ApplicationDbContext = OK
 Шаг 3: Получение ConfigurationDbContext...
 Шаг 3: ConfigurationDbContext = OK
 Шаг 4: Получение ILogger...
 Шаг 4: ILogger = OK
 Шаг 5: Проверка IsInMemory...
 Шаг 5.1: context.Database = OK
 Шаг 5: IsInMemory = False
 === Режим SQL Server (не InMemory) ===
 Шаг 6: Получение ICryptoService...
 Шаг 6: ICryptoService = OK
 Шаг 7: Вызов MigrateDatabase...
 ##################################################
 !!! MigrateDatabase НАЧАЛО v6 - С ПРОВЕРКОЙ !!!
 ##################################################
 === MigrateDatabase: НАЧАЛО ===
 Проверка Standalone режима...
 Standalone = False
 isStandalone = False
 === SQL Server миграция ===
 Миграция 1: Получение ApplicationDbContext...
 Миграция 1: Проверка нужна ли миграция...
 ShouldSkipMigration: Pending=5, Applied=0
 ShouldSkipMigration: Таблица 'AccessTokens' существует = True
 ShouldSkipMigration: Таблицы уже существуют, но __EFMigrationsHistory пустая!
 ShouldSkipMigration: Пропускаем Migrate() чтобы избежать ошибки 'object already exists'
 Миграция 1: ПРОПУСКАЕМ Migrate() - таблицы уже существуют!
 Миграция 1: Помечаем миграции как применённые...
 MarkMigrationsAsApplied: Добавлена запись для '20200512145632_InitialApplicationDbMigration'
 MarkMigrationsAsApplied: Добавлена запись для '20211102091321_MultipleProviders'
 MarkMigrationsAsApplied: Добавлена запись для '20230427065610_PasswordExpirationDate'
 MarkMigrationsAsApplied: Добавлена запись для '20230906133336_OldPassword'
 MarkMigrationsAsApplied: Добавлена запись для '20240311145607_RemoveSecrets'
 Миграция 2: Получение ConfigurationDbContext...
 Миграция 2: Проверка нужна ли миграция...
 ShouldSkipMigration: Pending=2, Applied=0
 ShouldSkipMigration: Таблица 'Clients' существует = True
 ShouldSkipMigration: Таблицы уже существуют, но __EFMigrationsHistory пустая!
 ShouldSkipMigration: Пропускаем Migrate() чтобы избежать ошибки 'object already exists'
 Миграция 2: ПРОПУСКАЕМ Migrate() - таблицы уже существуют!
 Миграция 2: Помечаем миграции как применённые...
 MarkMigrationsAsApplied: Добавлена запись для '20200512145618_InitialIdentityServerConfigurationDbMigration'
 MarkMigrationsAsApplied: Добавлена запись для '20211018165011_Migrate_3.1.4_to_4.1.2'
 Миграция 3: Получение PersistedGrantDbContext...
 Миграция 3: Проверка нужна ли миграция...
 ShouldSkipMigration: Pending=2, Applied=0
 ShouldSkipMigration: Таблица 'PersistedGrants' существует = True
 ShouldSkipMigration: Таблицы уже существуют, но __EFMigrationsHistory пустая!
 ShouldSkipMigration: Пропускаем Migrate() чтобы избежать ошибки 'object already exists'
 Миграция 3: ПРОПУСКАЕМ Migrate() - таблицы уже существуют!
 Миграция 3: Помечаем миграции как применённые...
 MarkMigrationsAsApplied: Добавлена запись для '20200512145607_InitialIdentityServerPersistedGrantDbMigration'
 MarkMigrationsAsApplied: Добавлена запись для '20211018201457_Migtaiondefrom3.1.4To4.1.2'
 Шаг 4: Получение DatabaseConnectionString...
 Шаг 4: DatabaseConnectionString = OK (длина: 111)
 DatabaseConnectionString (masked): Data Source=vmshqeatdb03;User ID=MS-HQ-Srvhopexusr_p;Password=***;encrypt=false;Database=HAS_2025;
 Шаг 5: Migrate_HAS_5_0To5_0_1...
 Migrate_HAS_5_0To5_0_1: НАЧАЛО
 Migrate_HAS_5_0To5_0_1: Соединение создано
 Migrate_HAS_5_0To5_0_1: Соединение открыто, State = Open
 Migrate_HAS_5_0To5_0_1: MigrateOldConfigTable<WindowsConfig>...
 MigrateOldConfigTable<WindowsConfig>: НАЧАЛО
 MigrateOldConfigTable<WindowsConfig>: Таблица не найдена (это OK) - Invalid object name 'dbo.WindowsConfig'.
 Migrate_HAS_5_0To5_0_1: MigrateOldConfigTable<HopexConfig>...
 MigrateOldConfigTable<HopexConfig>: НАЧАЛО
 MigrateOldConfigTable<HopexConfig>: Таблица не найдена (это OK) - Invalid object name 'dbo.HopexConfig'.
 Migrate_HAS_5_0To5_0_1: MigrateOldConfigTable<Saml2Config>...
 MigrateOldConfigTable<Saml2Config>: НАЧАЛО
 MigrateOldConfigTable<Saml2Config>: Таблица не найдена (это OK) - Invalid object name 'dbo.Saml2Config'.
 Migrate_HAS_5_0To5_0_1: MigrateOldConfigTable<OpenIdConfig>...
 MigrateOldConfigTable<OpenIdConfig>: НАЧАЛО
 MigrateOldConfigTable<OpenIdConfig>: Таблица не найдена (это OK) - Invalid object name 'dbo.OpenIdConfig'.
 Migrate_HAS_5_0To5_0_1: Обработка ApiResources...
 Migrate_HAS_5_0To5_0_1: ApiResources - OK
 Migrate_HAS_5_0To5_0_1: КОНЕЦ
 Шаг 5: Migrate_HAS_5_0To5_0_1 - OK
 Шаг 6: Migrate_HAS_5_0_xTo5_0_5...
 Migrate_HAS_5_0_xTo5_0_5: НАЧАЛО
 Migrate_HAS_5_0_xTo5_0_5: Соединение открыто
 Migrate_HAS_5_0_xTo5_0_5: updateClaimForSub<OpenIdConfig>...
 updateClaimForSub<OpenIdConfig>: НАЧАЛО
 updateClaimForSub<OpenIdConfig>: КОНЕЦ
 Migrate_HAS_5_0_xTo5_0_5: updateClaimForSub<Saml2Config>...
 updateClaimForSub<Saml2Config>: НАЧАЛО
 updateClaimForSub<Saml2Config>: КОНЕЦ
 Migrate_HAS_5_0_xTo5_0_5: КОНЕЦ
 Шаг 6: Migrate_HAS_5_0_xTo5_0_5 - OK
 Шаг 7: SQLCacheTableCreator...
 Шаг 7: SQLCacheTableCreator result = 0
 === MigrateDatabase: КОНЕЦ ===
 Шаг 7: MigrateDatabase - OK
 Шаг 8: EnsureSeedData (с cryptoService)...
 EnsureSeedData (with crypto): НАЧАЛО
 Seeding database...
 EnsureSeedData: Updating AccessTokens...
 EnsureSeedData: Добавлено AccessTokens: 0
 EnsureSeedData: Updating Clients...
 EnsureSeedData: Добавлено Clients: 0
 EnsureSeedData: Updating Scope...
 EnsureSeedData: Добавлено ApiScopes: 0
 EnsureSeedData: Updating IdentityResources...
 EnsureSeedData: Добавлено IdentityResources: 0
 EnsureSeedData: Updating ApiResources...
 EnsureSeedData: Добавлено ApiResources: 0
 EnsureSeedData: SaveChanges...
 EnsureSeedData: SaveChanges - OK
 EnsureSeedData (with crypto): КОНЕЦ
 Шаг 8: EnsureSeedData - OK
 Шаг 9: EnsureSeedData (uasContext)...
 EnsureSeedData (uasContext): НАЧАЛО
 Updating External Providers...
 EnsureSeedData (uasContext): Добавлено ExternalProviders: 0
 EnsureSeedData (uasContext): SaveChanges...
 EnsureSeedData (uasContext): SaveChanges - OK
 EnsureSeedData (uasContext): КОНЕЦ
 Шаг 9: EnsureSeedData - OK
 Шаг 10: EnsurePublicAddress...
 Шаг 10: publicAddress = https://vmshqeat04.npr.nornick.ru, isDevelopment = False
 EnsurePublicAddress: НАЧАЛО
 EnsurePublicAddress: publicAddress = https://vmshqeat04.npr.nornick.ru, isDevelopmentMode = False
 URLS Redirections are updating to public address https://vmshqeat04.npr.nornick.ru...
 EnsurePublicAddress: publicUri = https://vmshqeat04.npr.nornick.ru:443/
 EnsurePublicAddress: Обработано клиентов: 6
 EnsurePublicAddress: SaveChanges...
 EnsurePublicAddress: SaveChanges - OK
 EnsurePublicAddress: КОНЕЦ
 Шаг 10: EnsurePublicAddress - OK
 Закрытие соединения с БД...
 === EnsureSeedData: КОНЕЦ ===
 Using external provider OpenIdProvider
 Using external provider Saml2Provider
 Loading metadata for idp http://fedsvc.nornik.ru/adfs/services/trust
 Loading metadata for idp http://fedsvc.nornik.ru/adfs/services/trust
 Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
 Custom IssuerUri set to https://vmshqeat04.npr.nornick.ru
 Using the default authentication scheme Cookies for IdentityServer
 Using Cookies as default ASP.NET Core scheme for authentication
 Using Cookies as default ASP.NET Core scheme for sign-in
 Using Cookies as default ASP.NET Core scheme for sign-out
 Using OpenIdConnect as default ASP.NET Core scheme for challenge
 Using OpenIdConnect as default ASP.NET Core scheme for forbid
 Unhandled exception
System.Reflection.ReflectionTypeLoadException: Unable to load one or more of the requested types.
Could not load file or assembly 'System.Security.Cryptography.Xml, Version=8.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51'. The system cannot find the file specified.
   at RuntimeType[] System.Reflection.RuntimeModule.GetTypes(RuntimeModule module)
   at IEnumerable<TypeInfo> System.Reflection.RuntimeAssembly.get_DefinedTypes()
   at IEnumerable<TypeInfo> Microsoft.AspNetCore.Mvc.ApplicationParts.AssemblyPart.get_Types()
   at void Microsoft.AspNetCore.Mvc.Controllers.ControllerFeatureProvider.PopulateFeature(IEnumerable<ApplicationPart> parts, ControllerFeature feature)
   at void Microsoft.AspNetCore.Mvc.ApplicationParts.ApplicationPartManager.PopulateFeature<TFeature>(TFeature feature)
   at IEnumerable<TypeInfo> Microsoft.AspNetCore.Mvc.ApplicationModels.ControllerActionDescriptorProvider.GetControllerTypes()
   at IEnumerable<ControllerActionDescriptor> Microsoft.AspNetCore.Mvc.ApplicationModels.ControllerActionDescriptorProvider.GetDescriptors()
   at void Microsoft.AspNetCore.Mvc.ApplicationModels.ControllerActionDescriptorProvider.OnProvidersExecuting(ActionDescriptorProviderContext context)
   at void Microsoft.AspNetCore.Mvc.Infrastructure.DefaultActionDescriptorCollectionProvider.UpdateCollection()
   at void Microsoft.AspNetCore.Mvc.Infrastructure.DefaultActionDescriptorCollectionProvider.Initialize()
   at void Microsoft.AspNetCore.Mvc.Routing.ActionEndpointDataSourceBase.Subscribe()+() => { }
   at new Microsoft.Extensions.Primitives.ChangeToken+ChangeTokenRegistration<TState>(Func<IChangeToken> changeTokenProducer, Action<TState> changeTokenConsumer, TState state)
   at IDisposable Microsoft.Extensions.Primitives.ChangeToken.OnChange(Func<IChangeToken> changeTokenProducer, Action changeTokenConsumer)
   at void Microsoft.AspNetCore.Mvc.Routing.ActionEndpointDataSourceBase.Subscribe()
   at new Microsoft.AspNetCore.Mvc.Routing.ControllerActionEndpointDataSource(ControllerActionEndpointDataSourceIdProvider dataSourceIdProvider, IActionDescriptorCollectionProvider actions, ActionEndpointFactory endpointFactory, OrderedEndpointsSequenceProvider orderSequence)
   at ControllerActionEndpointDataSource Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.GetOrCreateDataSource(IEndpointRouteBuilder endpoints)
   at ControllerActionEndpointConventionBuilder Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute(IEndpointRouteBuilder endpoints, string name, string pattern, object defaults, object constraints, object dataTokens)
   at Task Program.Main(string[] args)+(IEndpointRouteBuilder endpoints) => { } in C:/DotnetFolder/source/HAS.Modules.UAS-master/HAS.Modules.UAS/Program.cs:line 99
   at IApplicationBuilder Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints(IApplicationBuilder builder, Action<IEndpointRouteBuilder> configure)
   at async Task Program.Main(string[] args) in C:/DotnetFolder/source/HAS.Modules.UAS-master/HAS.Modules.UAS/Program.cs:line 97
   at void Program.<Main>(?)
