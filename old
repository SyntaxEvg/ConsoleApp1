public static void EnsureSeedData(IServiceCollection serviceCollection, IClusterConfiguration serverConfigurations, AuthenticationBuilder authenticationBuilder)
		{
			ServiceProvider services = serviceCollection.BuildServiceProvider();
			using (IServiceScope scope = services.GetRequiredService<IServiceScopeFactory>().CreateScope())
			{
				ApplicationDbContext uasContext = scope.ServiceProvider.GetService<ApplicationDbContext>();
				ConfigurationDbContext context = scope.ServiceProvider.GetService<ConfigurationDbContext>();
				ILogger<SeedData> logger = services.GetService<ILogger<SeedData>>();
				if (!context.Database.IsInMemory())
				{
					try
					{
						ICryptoService cryptoService = services.GetRequiredService<ICryptoService>();
						SeedData.MigrateDatabase(logger, services, cryptoService);
						SeedData.EnsureSeedData(logger, serverConfigurations, uasContext, context, cryptoService);
						SeedData.EnsureSeedData(logger, uasContext);
						Microsoft.Extensions.Logging.ILogger logger2 = logger;
						ConfigurationDbContext configurationDbContext = context;
						string publicAddress = serverConfigurations.RuntimeClusterSettings.PublicAddress;
						RunningMode? mode = serverConfigurations.RuntimeClusterSettings.Mode;
						RunningMode runningMode = RunningMode.Development;
						SeedData.EnsurePublicAddress(logger2, configurationDbContext, publicAddress, (mode.GetValueOrDefault() == runningMode) & (mode != null));
						return;
					}
					finally
					{
						bool? testMode = serverConfigurations.StartingArguments.TestMode;
						bool flag = false;
						if ((testMode.GetValueOrDefault() == flag) & (testMode != null))
						{
							context.Database.CloseConnection();
						}
					}
				}
				SeedData.EnsureSeedData(logger, serverConfigurations, uasContext, context, null);
				SeedData.EnsureSeedData(logger, uasContext);
			}
		}
