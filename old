// –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ß–Å–†–ù–´–ô –°–ü–ò–°–û–ö –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ WordPress
add_filter('pre_http_request', function($preempt, $parsed_args, $url) {
    
    // –ß–Å–†–ù–´–ô –°–ü–ò–°–û–ö - –¥–æ–º–µ–Ω—ã –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    $blocked_domains = array(
        'api.wordpress.org',
        'wordpress.org', 
        'downloads.wordpress.org',
        's.w.org',
        'ps.w.org',
        // –î–æ–±–∞–≤–ª—è–π/—É–¥–∞–ª—è–π –¥–æ–º–µ–Ω—ã –∑–¥–µ—Å—å
    );
    
    // –ü–∞—Ä—Å–∏–º URL –∏ –ø–æ–ª—É—á–∞–µ–º –¥–æ–º–µ–Ω
    $host = parse_url($url, PHP_URL_HOST);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
    foreach ($blocked_domains as $blocked) {
        if ($host === $blocked || strpos($host, $blocked) !== false) {
            // –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
            if (defined('WP_DEBUG') && WP_DEBUG) {
                error_log(sprintf(
                    "üö´ BLOCKED HTTP REQUEST:\nURL: %s\nHost: %s\nMethod: %s",
                    $url,
                    $host,
                    isset($parsed_args['method']) ? $parsed_args['method'] : 'POST'
                ));
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
            return new WP_Error(
                'http_request_blocked',
                sprintf('HTTP request to %s blocked by security policy', $host),
                array('blocked_url' => $url)
            );
        }
    }
    
    // –ï—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - —Ä–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å
    return $preempt;
    
}, 10, 3);
