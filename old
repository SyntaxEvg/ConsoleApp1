// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
$token_data = ADFS_SSO_Auth::get_access_token($code);

if (is_wp_error($token_data)) {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ ...
}

// –î–û–ë–ê–í–¨–¢–ï –≠–¢–û:
error_log('ADFS: ========================================');
error_log('ADFS: –ü–†–û–í–ï–†–ö–ê ID TOKEN');
error_log('ADFS: ========================================');

if (!empty($token_data['id_token_payload'])) {
    error_log('ADFS: ‚úì ID Token –Ω–∞–π–¥–µ–Ω!');
    error_log('ADFS: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ ID Token:');
    error_log(print_r($token_data['id_token_payload'], true));
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ ID Token –≤–º–µ—Å—Ç–æ UserInfo
    error_log('ADFS: üí° –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ ID Token –≤–º–µ—Å—Ç–æ UserInfo!');
    $user_info = $token_data['id_token_payload'];
} else {
    error_log('ADFS: ‚ùå ID Token –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º UserInfo');
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    $user_info = ADFS_SSO_Auth::get_user_info($token_data['access_token']);
    
    if (is_wp_error($user_info)) {
        // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ ...
    }
}

error_log('ADFS: ========================================');
error_log('ADFS: –ò–¢–û–ì–û–í–´–ï –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:');
error_log('ADFS: ========================================');
error_log(print_r($user_info, true));
