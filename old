public static function get_access_token($code) {
    $config = ADFS_SSO_Config::get_config();
    
    if (empty($config['token_url']) || empty($config['client_id']) || empty($config['client_secret'])) {
        error_log('ADFS: ‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!');
        return new WP_Error('adfs_config_error', 'ADFS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
    }
    
    error_log('========================================');
    error_log('ADFS: –ü–û–õ–£–ß–ï–ù–ò–ï ACCESS TOKEN');
    error_log('========================================');
    error_log('ADFS: Token URL: ' . $config['token_url']);
    error_log('ADFS: Code (–ø–µ—Ä–≤—ã–µ 30): ' . substr($code, 0, 30) . '...');
    
    $body = array(
        'grant_type'    => 'authorization_code',
        'code'          => $code,
        'redirect_uri'  => $config['redirect_uri'],
        'client_id'     => $config['client_id'],
        'client_secret' => $config['client_secret'],
    );
    
    // –õ–æ–≥–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–∞)
    $body_log = $body;
    $body_log['client_secret'] = '***HIDDEN***';
    error_log('ADFS: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞: ' . print_r($body_log, true));
    
    $args = array(
        'body'      => $body,
        'timeout'   => 30,
        'sslverify' => false,
        'headers'   => array(
            'Content-Type' => 'application/x-www-form-urlencoded',
        ),
    );
    
    error_log('ADFS: ‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—é POST –∑–∞–ø—Ä–æ—Å –Ω–∞ token endpoint...');
    
    // –ó–∞—Å–µ–∫–∞–µ–º –≤—Ä–µ–º—è
    $start_time = microtime(true);
    
    $response = wp_remote_post($config['token_url'], $args);
    
    $end_time = microtime(true);
    $duration = round(($end_time - $start_time) * 1000, 2);
    
    error_log('ADFS: ‚è±Ô∏è  –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω –∑–∞ ' . $duration . ' –º—Å');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ WP_Error
    if (is_wp_error($response)) {
        error_log('ADFS: ‚ùå WP_Error –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ!');
        error_log('ADFS: Error code: ' . $response->get_error_code());
        error_log('ADFS: Error message: ' . $response->get_error_message());
        error_log('ADFS: Error data: ' . print_r($response->get_error_data(), true));
        return $response;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º HTTP –∫–æ–¥ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
    $http_code = wp_remote_retrieve_response_code($response);
    $http_message = wp_remote_retrieve_response_message($response);
    $response_headers = wp_remote_retrieve_headers($response);
    $body_response = wp_remote_retrieve_body($response);
    
    error_log('ADFS: ========================================');
    error_log('ADFS: üì• –û–¢–í–ï–¢ –û–¢ ADFS TOKEN ENDPOINT');
    error_log('ADFS: ========================================');
    error_log('ADFS: HTTP Code: ' . $http_code);
    error_log('ADFS: HTTP Message: ' . $http_message);
    
    error_log('ADFS: Response Headers:');
    if (is_array($response_headers) || is_object($response_headers)) {
        foreach ($response_headers as $header_key => $header_value) {
            if (is_array($header_value)) {
                error_log('  ' . $header_key . ': ' . implode(', ', $header_value));
            } else {
                error_log('  ' . $header_key . ': ' . $header_value);
            }
        }
    }
    
    error_log('ADFS: ========================================');
    error_log('ADFS: üìÑ RAW RESPONSE BODY (–ü–û–õ–ù–´–ô):');
    error_log('ADFS: ========================================');
    error_log($body_response);
    error_log('ADFS: ========================================');
    error_log('ADFS: –†–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞: ' . strlen($body_response) . ' –±–∞–π—Ç');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTP –∫–æ–¥
    if ($http_code !== 200) {
        error_log('ADFS: ‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π HTTP –∫–æ–¥: ' . $http_code);
        return new WP_Error(
            'adfs_token_http_error',
            'ADFS –≤–µ—Ä–Ω—É–ª –∫–æ–¥ ' . $http_code . ': ' . $body_response
        );
    }
    
    // –ü–∞—Ä—Å–∏–º JSON
    error_log('ADFS: üîç –ü–∞—Ä—Å–∏–Ω–≥ JSON...');
    $data = json_decode($body_response, true);
    
    if (json_last_error() !== JSON_ERROR_NONE) {
        error_log('ADFS: ‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON!');
        error_log('ADFS: JSON error: ' . json_last_error_msg());
        error_log('ADFS: JSON error code: ' . json_last_error());
        return new WP_Error('adfs_json_error', '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' . json_last_error_msg());
    }
    
    error_log('ADFS: ‚úì JSON —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω');
    error_log('ADFS: ========================================');
    error_log('ADFS: üîë –†–ê–°–ü–ê–†–°–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï –¢–û–ö–ï–ù–ê');
    error_log('ADFS: ========================================');
    
    // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –∫–ª—é—á–∏
    error_log('ADFS: –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –≤ –æ—Ç–≤–µ—Ç–µ:');
    error_log('  ' . implode(', ', array_keys($data)));
    
    // –õ–æ–≥–∏—Ä—É–µ–º –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ
    foreach ($data as $key => $value) {
        if ($key === 'access_token' || $key === 'refresh_token' || $key === 'id_token') {
            // –¢–æ–∫–µ–Ω—ã –ª–æ–≥–∏—Ä—É–µ–º —á–∞—Å—Ç–∏—á–Ω–æ
            error_log('ADFS: ' . $key . ': ' . substr($value, 0, 50) . '... (–¥–ª–∏–Ω–∞: ' . strlen($value) . ')');
        } else {
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
            error_log('ADFS: ' . $key . ': ' . $value);
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ access_token
    if (empty($data['access_token'])) {
        error_log('ADFS: ‚ùå –í –æ—Ç–≤–µ—Ç–µ –Ω–µ—Ç access_token!');
        error_log('ADFS: –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç: ' . print_r($data, true));
        
        $error_msg = '–í –æ—Ç–≤–µ—Ç–µ ADFS –Ω–µ—Ç access_token';
        if (!empty($data['error'])) {
            $error_msg .= ': ' . $data['error'];
        }
        if (!empty($data['error_description'])) {
            $error_msg .= ' - ' . $data['error_description'];
        }
        
        return new WP_Error('adfs_no_token', $error_msg);
    }
    
    error_log('ADFS: ‚úì access_token –ø–æ–ª—É—á–µ–Ω!');
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å ID Token - –ø–∞—Ä—Å–∏–º –µ–≥–æ
    if (!empty($data['id_token'])) {
        error_log('ADFS: üîç –ù–∞–π–¥–µ–Ω ID Token, –ø–∞—Ä—Å–∏–º...');
        
        $id_parts = explode('.', $data['id_token']);
        if (count($id_parts) === 3) {
            $payload_base64 = strtr($id_parts[1], '-_', '+/');
            $payload_json = base64_decode($payload_base64);
            $id_payload = json_decode($payload_json, true);
            
            if ($id_payload) {
                error_log('ADFS: ========================================');
                error_log('ADFS: üé´ –°–û–î–ï–†–ñ–ò–ú–û–ï ID TOKEN');
                error_log('ADFS: ========================================');
                error_log('ADFS: ID Token payload:');
                error_log(print_r($id_payload, true));
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                $data['id_token_payload'] = $id_payload;
            }
        }
    }
    
    error_log('ADFS: ========================================');
    error_log('ADFS: ‚úÖ get_access_token() –ó–ê–í–ï–†–®–Å–ù –£–°–ü–ï–®–ù–û');
    error_log('ADFS: ========================================');
    
    return $data;
}
